apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-infrastructure-dashboards
  labels:
    app: grafana
    grafana_dashboard: "1"
data:
  infrastructure-dashboard.json: |
    {
      "__inputs": [
        {
          "name": "DS_PROMETHEUS",
          "label": "Prometheus",
          "description": "",
          "type": "datasource",
          "pluginId": "prometheus",
          "pluginName": "Prometheus"
        }
      ],
      "__requires": [
        {
          "type": "grafana",
          "id": "grafana",
          "name": "Grafana",
          "version": "8.0.0"
        },
        {
          "type": "datasource",
          "id": "prometheus",
          "name": "Prometheus",
          "version": "1.0.0"
        }
      ],
      "id": null,
      "title": "AI Event Concepter - Infrastructure Overview",
      "uid": "ai-event-concepter-infrastructure",
      "tags": [
        "ai-event-concepter",
        "infrastructure",
        "system",
        "monitoring"
      ],
      "style": "dark",
      "timezone": "browser",
      "panels": [
        {
          "id": 1,
          "title": "Node CPU Usage",
          "type": "graph",
          "targets": [
            {
              "expr": "100 - (avg by(instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
              "legendFormat": "{{`{{`}}instance{{`}}`}}",
              "datasource": "Prometheus"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "min": 0,
              "max": 100
            }
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 0
          }
        },
        {
          "id": 2,
          "title": "Node Memory Usage",
          "type": "graph",
          "targets": [
            {
              "expr": "(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100",
              "legendFormat": "{{`{{`}}instance{{`}}`}}",
              "datasource": "Prometheus"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "min": 0,
              "max": 100
            }
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 0
          }
        },
        {
          "id": 3,
          "title": "Disk Usage",
          "type": "graph",
          "targets": [
            {
              "expr": "(node_filesystem_size_bytes - node_filesystem_avail_bytes) / node_filesystem_size_bytes * 100",
              "legendFormat": "{{`{{`}}instance{{`}}`}} - {{`{{`}}mountpoint{{`}}`}}",
              "datasource": "Prometheus"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "min": 0,
              "max": 100
            }
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 8
          }
        },
        {
          "id": 4,
          "title": "Network Traffic",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(node_network_receive_bytes_total[5m])",
              "legendFormat": "{{`{{`}}instance{{`}}`}} - {{`{{`}}device{{`}}`}} - RX",
              "datasource": "Prometheus"
            },
            {
              "expr": "rate(node_network_transmit_bytes_total[5m])",
              "legendFormat": "{{`{{`}}instance{{`}}`}} - {{`{{`}}device{{`}}`}} - TX",
              "datasource": "Prometheus"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "bytes"
            }
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 8
          }
        },
        {
          "id": 5,
          "title": "Container CPU Usage",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(container_cpu_usage_seconds_total{container!=\"\"}[5m]) * 100",
              "legendFormat": "{{`{{`}}name{{`}}`}}",
              "datasource": "Prometheus"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent"
            }
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 16
          }
        },
        {
          "id": 6,
          "title": "Container Memory Usage",
          "type": "graph",
          "targets": [
            {
              "expr": "container_memory_usage_bytes{container!=\"\"}",
              "legendFormat": "{{`{{`}}name{{`}}`}}",
              "datasource": "Prometheus"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "bytes"
            }
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 16
          }
        },
        {
          "id": 7,
          "title": "PostgreSQL Active Connections",
          "type": "graph",
          "targets": [
            {
              "expr": "pg_stat_database_numbackends",
              "legendFormat": "{{`{{`}}datname{{`}}`}}",
              "datasource": "Prometheus"
            }
          ],
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 24
          }
        },
        {
          "id": 8,
          "title": "PostgreSQL Transaction Rate",
          "type": "graph",
          "targets": [
            {
              "expr": "rate(pg_stat_database_xact_commit[5m])",
              "legendFormat": "{{`{{`}}datname{{`}}`}} - Commits",
              "datasource": "Prometheus"
            },
            {
              "expr": "rate(pg_stat_database_xact_rollback[5m])",
              "legendFormat": "{{`{{`}}datname{{`}}`}} - Rollbacks",
              "datasource": "Prometheus"
            }
          ],
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 24
          }
        },
        {
          "id": 9,
          "title": "System Load Average",
          "type": "graph",
          "targets": [
            {
              "expr": "node_load1",
              "legendFormat": "{{`{{`}}instance{{`}}`}} - 1m",
              "datasource": "Prometheus"
            },
            {
              "expr": "node_load5",
              "legendFormat": "{{`{{`}}instance{{`}}`}} - 5m",
              "datasource": "Prometheus"
            },
            {
              "expr": "node_load15",
              "legendFormat": "{{`{{`}}instance{{`}}`}} - 15m",
              "datasource": "Prometheus"
            }
          ],
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 32
          }
        }
      ],
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "refresh": "30s"
    } 